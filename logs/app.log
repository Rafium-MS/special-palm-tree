2025-07-25 15:56:15 [INFO] Território adicionado: 1
2025-07-25 16:38:41 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-25 16:38:57 [INFO] Território adicionado: 1
2025-07-25 16:39:01 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:39:04 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:39:05 [INFO] Território atualizado: ID=1, Nome=1
2025-07-25 16:39:10 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:39:16 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-25 16:44:41 [INFO] Território adicionado: 2
2025-07-25 16:45:32 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-25 16:45:33 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-25 16:45:41 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:46:38 [INFO] Território atualizado: ID=1, Nome=1
2025-07-25 16:54:28 [INFO] Território adicionado: 3
2025-07-25 16:54:32 [INFO] Território adicionado: 4
2025-07-25 16:54:34 [INFO] Território adicionado: 5
2025-07-25 16:54:36 [INFO] Território adicionado: 6
2025-07-25 16:54:38 [INFO] Território adicionado: 7
2025-07-25 16:54:42 [INFO] Território adicionado: 8
2025-07-25 16:55:30 [INFO] Território adicionado: 9
2025-07-25 16:55:39 [INFO] Território adicionado: 10
2025-07-25 16:55:43 [INFO] Território adicionado: 11
2025-07-25 16:59:31 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:59:33 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:59:36 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:59:39 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-25 16:59:40 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-25 17:00:00 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-28 10:26:00 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:28:04 [INFO] Território adicionado: 1
2025-07-28 10:28:10 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:28:38 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-28 10:28:41 [INFO] Território atualizado: ID=1, Nome=1
2025-07-28 10:39:44 [INFO] Território adicionado: 1
2025-07-28 10:39:47 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 10:39:51 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:39:59 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:40:05 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 10:40:07 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:40:26 [INFO] Território atualizado: ID=1, Nome=1
2025-07-28 10:40:28 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:40:29 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:40:34 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 10:40:35 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 11:01:16 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 11:01:16 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 11:01:18 [INFO] Território atualizado: ID=1, Nome=1
2025-07-28 11:01:32 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 11:01:44 [ERROR] Erro ao buscar endereços: No connection adapters were found for 'from PyQt5.QtWidgets import (\n    QWidget, QVBoxLayout, QLabel, QPushButton,\n    QTableWidget, QTableWidgetItem, QHBoxLayout\n)\nfrom database.db_manager import get_connection\nfrom datetime import datetime, timedelta\n\nclass DesignacoesView(QWidget):\n    def __init__(self, parent=None):\n        super().__init__()\n        self.setWindowTitle("Designações")\n        self.setMinimumWidth(900)\n        self.parent_widget = parent  # necessário para atualizar status/toast\n        layout = QVBoxLayout()\n        self.setLayout(layout)\n\n        # \U0001f518 Botões\n        layout_botoes = QHBoxLayout()\n        self.btn_gerar_otimizado = QPushButton("Gerar Designação Otimizada")\n        self.btn_gerar_otimizado.clicked.connect(self.gerar_designacao_otimizada)\n        layout_botoes.addWidget(self.btn_gerar_otimizado)\n        layout.addLayout(layout_botoes)\n\n        # \U0001f4cb Tabela\n        self.tabela = QTableWidget()\n        self.tabela.setColumnCount(5)\n        self.tabela.setHorizontalHeaderLabels(["Território", "Rua", "Número", "Tipo", "Status"])\n        layout.addWidget(self.tabela)\n\n    def atualizar_status(self, msg, tipo="info"):\n        if self.parent_widget and hasattr(self.parent_widget, "atualizar_status"):\n            self.parent_widget.atualizar_status(msg, tipo)\n\n    def numero_recente(self, rua_id, numero, meses=3):\n        """Verifica se o número foi designado nos últimos X meses"""\n        conn = get_connection()\n        cur = conn.cursor()\n        limite = datetime.now() - timedelta(days=30 * meses)\n        limite_str = limite.strftime("%Y-%m-%d")\n\n        cur.execute("""\n            SELECT COUNT(*) FROM numeros\n            WHERE rua_id = ? AND numero = ? AND DATE(data_coleta) >= DATE(?)\n        """, (rua_id, numero, limite_str))\n\n        resultado = cur.fetchone()[0]\n        conn.close()\n        return resultado > 0\n\n    def gerar_designacao_otimizada(self):\n        conn = get_connection()\n        cur = conn.cursor()\n\n        cur.execute("SELECT id, nome FROM territorios")\n        territorios = cur.fetchall()\n        designacoes = []\n\n        for territorio_id, nome_territorio in territorios:\n            cur.execute("SELECT id, nome FROM ruas WHERE territorio_id = ?", (territorio_id,))\n            ruas = cur.fetchall()\n\n            for rua_id, nome_rua in ruas:\n                cur.execute("""\n                    SELECT DISTINCT numero, tipo, status\n                    FROM numeros\n                    WHERE rua_id = ?\n                    ORDER BY data_coleta DESC\n                """, (rua_id,))\n                numeros = cur.fetchall()\n\n                for numero, tipo, status in numeros:\n                    if not self.numero_recente(rua_id, numero, meses=3):\n                        designacoes.append([nome_territorio, nome_rua, numero, tipo, status])\n                        break  # apenas um número por rua\n\n        conn.close()\n\n        # Exibir resultado\n        self.tabela.setRowCount(len(designacoes))\n        for i, linha in enumerate(designacoes):\n            for j, valor in enumerate(linha):\n                self.tabela.setItem(i, j, QTableWidgetItem(str(valor)))\n\n        self.atualizar_status("Designação otimizada gerada com sucesso.", "sucesso")\n'
2025-07-28 11:01:50 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 11:01:55 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 11:01:56 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 11:02:07 [INFO] Território atualizado: ID=1, Nome=1
2025-07-28 11:02:11 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-28 11:17:11 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 11:17:13 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 11:17:21 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-28 11:17:36 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-28 11:37:40 [INFO] Território adicionado: 1
2025-07-28 11:37:42 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 11:37:43 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 11:37:50 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 11:37:52 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 11:45:15 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-28 12:30:34 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 12:30:40 [INFO] Território atualizado: ID=1, Nome=1
2025-07-28 12:30:42 [ERROR] Erro ao buscar endereços: Invalid URL 'None': No scheme supplied. Perhaps you meant https://None?
2025-07-28 12:31:31 [INFO] Território adicionado: 1
2025-07-28 16:09:14 [INFO] Território adicionado: 1
2025-07-28 16:10:16 [INFO] Importação de territórios da web: 71 novos adicionados.
2025-07-28 16:11:58 [INFO] Importação de territórios da web: 0 novos adicionados.
2025-07-28 16:13:19 [INFO] Território atualizado: ID=28, Nome=Território 30
2025-07-28 16:14:19 [INFO] Importação concluída. 0 novos territórios adicionados.
2025-07-28 16:21:02 [INFO] Importação de territórios da web: 71 novos adicionados.
